<?xml version="1.0" encoding="utf-8"?>
<!--
==============================================================================
px4xplane (PixEagle) - Professional Visual Studio Project File
X-Plane Plugin for PX4 SITL Integration
Repository: alireza787b/px4xplane
FIXED: Proper X-Plane plugin directory structure
==============================================================================
-->
<Project DefaultTargets="Build" ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    <ProjectConfiguration Include="Debug|x64">
      <Configuration>Debug</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
    <ProjectConfiguration Include="Release|x64">
      <Configuration>Release</Configuration>
      <Platform>x64</Platform>
    </ProjectConfiguration>
  </ItemGroup>
  <!-- Project Properties -->
  <PropertyGroup Label="Globals">
    <ProjectGuid>{2BCD1D06-76FC-4DE7-A860-98081316BC6B}</ProjectGuid>
    <ProjectName>px4xplane</ProjectName>
    <WindowsTargetPlatformVersion>10.0</WindowsTargetPlatformVersion>
    <RootNamespace>px4xplane</RootNamespace>
  </PropertyGroup>
  <!-- Import Default Props -->
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <!-- Configuration Types -->
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseOfMfc>false</UseOfMfc>
    <CharacterSet>Unicode</CharacterSet>
    <PlatformToolset>v143</PlatformToolset>
    <UseDebugLibraries>true</UseDebugLibraries>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'" Label="Configuration">
    <ConfigurationType>DynamicLibrary</ConfigurationType>
    <UseOfMfc>false</UseOfMfc>
    <CharacterSet>Unicode</CharacterSet>
    <PlatformToolset>v143</PlatformToolset>
    <UseDebugLibraries>false</UseDebugLibraries>
    <WholeProgramOptimization>true</WholeProgramOptimization>
  </PropertyGroup>
  <!-- Import CPP Props -->
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  <ImportGroup Label="Shared">
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <ImportGroup Label="PropertySheets" Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <Import Project="$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props" Condition="exists('$(UserRootDir)\Microsoft.Cpp.$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>
  <!-- User Macros -->
  <PropertyGroup Label="UserMacros" />
  <!-- ✅ FIXED: Proper X-Plane Plugin Directory Structure -->
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <OutDir>$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\64\</OutDir>
    <IntDir>$(SolutionDir)build\windows\debug\obj\</IntDir>
    <TargetName>win</TargetName>
    <TargetExt>.xpl</TargetExt>
    <GenerateManifest>false</GenerateManifest>
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <OutDir>$(SolutionDir)build\windows\release\plugins\$(ProjectName)\64\</OutDir>
    <IntDir>$(SolutionDir)build\windows\release\obj\</IntDir>
    <TargetName>win</TargetName>
    <TargetExt>.xpl</TargetExt>
    <GenerateManifest>false</GenerateManifest>
    <LinkIncremental>false</LinkIncremental>
  </PropertyGroup>
  <!-- Debug Configuration -->
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
    <ClCompile>
      <!-- Compiler Settings -->
      <WarningLevel>Level3</WarningLevel>
      <Optimization>Disabled</Optimization>
      <RuntimeLibrary>MultiThreadedDebugDLL</RuntimeLibrary>
      <DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
      <BasicRuntimeChecks>EnableFastChecks</BasicRuntimeChecks>
      <FunctionLevelLinking>false</FunctionLevelLinking>
      <InlineFunctionExpansion>Default</InlineFunctionExpansion>
      <LanguageStandard>stdcpp17</LanguageStandard>
      <ConformanceMode>true</ConformanceMode>
      <!-- Include Directories (All Dependencies) -->
      <AdditionalIncludeDirectories>
        $(ProjectDir)include;
        $(ProjectDir)lib\SDK\CHeaders\XPLM;
        $(ProjectDir)lib\SDK\CHeaders\Widgets;
        $(ProjectDir)lib\mavlink\c_library_v2;
        $(ProjectDir)lib\mavlink\c_library_v2\common;
        $(ProjectDir)lib\mavlink\c_library_v2\all;
        $(ProjectDir)lib\simpleini;
        $(ProjectDir)lib\Eigen;
        $(ProjectDir)lib\XYZgeomag\src;
        $(ProjectDir)config;
        %(AdditionalIncludeDirectories)
      </AdditionalIncludeDirectories>
      <!-- Preprocessor Definitions -->
      <PreprocessorDefinitions>
        WIN32;
        _DEBUG;
        _WINDOWS;
        _USRDLL;
        IBM=1;
        XPLM200=1;
        XPLM210=1;
        XPLM300=1;
        XPLM301=1;
        XPLM302=1;
        XPLM303=1;
        XPLM400=1;
        _CRT_SECURE_NO_WARNINGS;
        _CRT_NONSTDC_NO_DEPRECATE;
        WINVER=0x0A00;
        _WIN32_WINNT=0x0A00;
        %(PreprocessorDefinitions)
      </PreprocessorDefinitions>
      <!-- Output Settings -->
      <ObjectFileName>$(IntDir)</ObjectFileName>
      <ProgramDataBaseFileName>$(IntDir)px4xplane.pdb</ProgramDataBaseFileName>
      <SuppressStartupBanner>true</SuppressStartupBanner>
    </ClCompile>
    <Link>
      <!-- Linker Settings -->
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <LinkDLL>true</LinkDLL>
      <SubSystem>Console</SubSystem>
      <SuppressStartupBanner>true</SuppressStartupBanner>
      <!-- Library Directories -->
      <AdditionalLibraryDirectories>
        $(ProjectDir)lib\SDK\Libraries\Win;
        %(AdditionalLibraryDirectories)
      </AdditionalLibraryDirectories>
      <!-- Library Dependencies -->
      <AdditionalDependencies>
        XPLM_64.lib;
        XPWidgets_64.lib;
        Opengl32.lib;
        ws2_32.lib;
        %(AdditionalDependencies)
      </AdditionalDependencies>
      <!-- Output Settings -->
      <OutputFile>$(OutDir)$(TargetName)$(TargetExt)</OutputFile>
      <ImportLibrary>$(IntDir)$(TargetName).lib</ImportLibrary>
    </Link>
    <!-- ✅ IMPROVED: Post-Build Event with X-Plane Plugin Structure -->
    <PostBuildEvent>
      <Command>
echo ===============================================
echo   px4xplane Plugin Build Completed (DEBUG)
echo ===============================================
echo.
echo Creating X-Plane plugin structure...

REM Create the main plugin directory if it doesn't exist
if not exist "$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\" mkdir "$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\"

REM Copy configuration file to 64/ directory (with binary)
if exist "$(ProjectDir)config\config.ini" (
    copy "$(ProjectDir)config\config.ini" "$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\64\" /Y
    echo ✓ Configuration file copied: config.ini
) else (
    echo ⚠ Warning: config.ini not found in $(ProjectDir)config\
)

REM Copy README to plugin root
if exist "$(ProjectDir)README.md" (
    copy "$(ProjectDir)README.md" "$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\" /Y
    echo ✓ Documentation copied: README.md
)

REM Create px4_airframes directory
if not exist "$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\px4_airframes\" (
    mkdir "$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\px4_airframes\"
)

REM Copy PX4 parameter files to px4_airframes/
for %%f in ("$(ProjectDir)config\px4_params\*") do (
    copy "%%f" "$(SolutionDir)build\windows\debug\plugins\$(ProjectName)\px4_airframes\" /Y
)
echo ✓ PX4 airframe parameters copied to px4_airframes/

echo.
echo ✓ Plugin built successfully:
echo   📁 $(OutDir)$(TargetName)$(TargetExt)
echo   📁 $(SolutionDir)build\windows\debug\plugins\$(ProjectName)\64\config.ini
echo   📁 $(SolutionDir)build\windows\debug\plugins\$(ProjectName)\px4_airframes\
echo.
echo Ready for X-Plane installation!
echo Copy the entire 'px4xplane' folder to:
echo   X-Plane\Resources\plugins\
echo ===============================================
      </Command>
      <Message>Creating X-Plane plugin structure and copying resources</Message>
    </PostBuildEvent>
  </ItemDefinitionGroup>
  <!-- Release Configuration -->
  <ItemDefinitionGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
    <ClCompile>
      <!-- Compiler Settings -->
      <WarningLevel>Level3</WarningLevel>
      <Optimization>MaxSpeed</Optimization>
      <RuntimeLibrary>MultiThreadedDLL</RuntimeLibrary>
      <FunctionLevelLinking>true</FunctionLevelLinking>
      <IntrinsicFunctions>true</IntrinsicFunctions>
      <StringPooling>true</StringPooling>
      <FavorSizeOrSpeed>Speed</FavorSizeOrSpeed>
      <EnableParallelCodeGeneration>true</EnableParallelCodeGeneration>
      <LanguageStandard>stdcpp17</LanguageStandard>
      <ConformanceMode>true</ConformanceMode>
      <DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
      <!-- Include Directories (All Dependencies) -->
      <AdditionalIncludeDirectories>
        $(ProjectDir)include;
        $(ProjectDir)lib\SDK\CHeaders\XPLM;
        $(ProjectDir)lib\SDK\CHeaders\Widgets;
        $(ProjectDir)lib\mavlink\c_library_v2;
        $(ProjectDir)lib\mavlink\c_library_v2\common;
        $(ProjectDir)lib\mavlink\c_library_v2\all;
        $(ProjectDir)lib\simpleini;
        $(ProjectDir)lib\Eigen;
        $(ProjectDir)lib\XYZgeomag\src;
        $(ProjectDir)config;
        %(AdditionalIncludeDirectories)
      </AdditionalIncludeDirectories>
      <!-- Preprocessor Definitions -->
      <PreprocessorDefinitions>
        WIN32;
        NDEBUG;
        _WINDOWS;
        _USRDLL;
        IBM=1;
        XPLM200=1;
        XPLM210=1;
        XPLM300=1;
        XPLM301=1;
        XPLM302=1;
        XPLM303=1;
        XPLM400=1;
        _CRT_SECURE_NO_WARNINGS;
        _CRT_NONSTDC_NO_DEPRECATE;
        WINVER=0x0A00;
        _WIN32_WINNT=0x0A00;
        %(PreprocessorDefinitions)
      </PreprocessorDefinitions>
      <!-- Output Settings -->
      <ObjectFileName>$(IntDir)</ObjectFileName>
      <ProgramDataBaseFileName>$(IntDir)px4xplane.pdb</ProgramDataBaseFileName>
      <SuppressStartupBanner>true</SuppressStartupBanner>
    </ClCompile>
    <Link>
      <!-- Linker Settings -->
      <GenerateDebugInformation>true</GenerateDebugInformation>
      <LinkDLL>true</LinkDLL>
      <SubSystem>Console</SubSystem>
      <OptimizeReferences>true</OptimizeReferences>
      <EnableCOMDATFolding>true</EnableCOMDATFolding>
      <SuppressStartupBanner>true</SuppressStartupBanner>
      <!-- Library Directories -->
      <AdditionalLibraryDirectories>
        $(ProjectDir)lib\SDK\Libraries\Win;
        %(AdditionalLibraryDirectories)
      </AdditionalLibraryDirectories>
      <!-- Library Dependencies -->
      <AdditionalDependencies>
        XPLM_64.lib;
        XPWidgets_64.lib;
        Opengl32.lib;
        ws2_32.lib;
        %(AdditionalDependencies)
      </AdditionalDependencies>
      <!-- Output Settings -->
      <OutputFile>$(OutDir)$(TargetName)$(TargetExt)</OutputFile>
      <ImportLibrary>$(IntDir)$(TargetName).lib</ImportLibrary>
    </Link>
    <!-- ✅ IMPROVED: Post-Build Event with X-Plane Plugin Structure -->
    <PostBuildEvent>
      <Command>
echo ===============================================
echo   px4xplane Plugin Build Completed (RELEASE)
echo ===============================================
echo.
echo Creating X-Plane plugin structure...

REM Create the main plugin directory if it doesn't exist
if not exist "$(SolutionDir)build\windows\release\plugins\$(ProjectName)\" mkdir "$(SolutionDir)build\windows\release\plugins\$(ProjectName)\"

REM Copy configuration file to 64/ directory (with binary)
if exist "$(ProjectDir)config\config.ini" (
    copy "$(ProjectDir)config\config.ini" "$(SolutionDir)build\windows\release\plugins\$(ProjectName)\64\" /Y
    echo ✓ Configuration file copied: config.ini
) else (
    echo ⚠ Warning: config.ini not found in $(ProjectDir)config\
)

REM Copy README to plugin root
if exist "$(ProjectDir)README.md" (
    copy "$(ProjectDir)README.md" "$(SolutionDir)build\windows\release\plugins\$(ProjectName)\" /Y
    echo ✓ Documentation copied: README.md
)

REM Create px4_airframes directory
if not exist "$(SolutionDir)build\windows\release\plugins\$(ProjectName)\px4_airframes\" (
    mkdir "$(SolutionDir)build\windows\release\plugins\$(ProjectName)\px4_airframes\"
)

REM Copy PX4 parameter files to px4_airframes/
for %%f in ("$(ProjectDir)config\px4_params\*") do (
    copy "%%f" "$(SolutionDir)build\windows\release\plugins\$(ProjectName)\px4_airframes\" /Y
)
echo ✓ PX4 airframe parameters copied to px4_airframes/

echo.
echo ✓ Plugin built successfully:
echo   📁 $(OutDir)$(TargetName)$(TargetExt)
echo   📁 $(SolutionDir)build\windows\release\plugins\$(ProjectName)\64\config.ini
echo   📁 $(SolutionDir)build\windows\release\plugins\$(ProjectName)\px4_airframes\
echo.
echo Ready for X-Plane installation!
echo Copy the entire 'px4xplane' folder to:
echo   X-Plane\Resources\plugins\
echo ===============================================
      </Command>
      <Message>Creating X-Plane plugin structure and copying resources</Message>
    </PostBuildEvent>
  </ItemDefinitionGroup>
  <!-- Source Files -->
  <ItemGroup>
    <ClCompile Include="src\ConfigManager.cpp" />
    <ClCompile Include="src\configReader.cpp" />
    <ClCompile Include="src\ConnectionManager.cpp" />
    <ClCompile Include="src\ConnectionStatusHUD.cpp" />
    <ClCompile Include="src\DataRefManager.cpp" />
    <ClCompile Include="src\MAVLinkManager.cpp" />
    <ClCompile Include="src\px4xplane.cpp" />
    <ClCompile Include="src\TimeManager.cpp" />
    <ClCompile Include="src\UIConstants.cpp" />
    <ClCompile Include="src\UIHandler.cpp" />
  </ItemGroup>
  <!-- Header Files -->
  <ItemGroup>
    <ClInclude Include="include\ConfigManager.h" />
    <ClInclude Include="include\configReader.h" />
    <ClInclude Include="include\ConnectionManager.h" />
    <ClInclude Include="include\ConnectionStatusHUD.h" />
    <ClInclude Include="include\DataRefManager.h" />
    <ClInclude Include="include\MAVLinkManager.h" />
    <ClInclude Include="include\TimeManager.h" />
    <ClInclude Include="config\ini.h" />
    <ClInclude Include="include\UIConstants.h" />
    <ClInclude Include="include\UIHandler.h" />
    <ClInclude Include="include\VersionInfo.h" />
    <ClInclude Include="resource.h" />
    <ClInclude Include="lib\XYZgeomag\src\XYZgeomag.hpp" />
  </ItemGroup>
  <!-- Resource Files -->
  <ItemGroup>
    <ResourceCompile Include="px4xplane.rc" />
  </ItemGroup>
  <!-- Additional Files -->
  <ItemGroup>
    <None Include="config\config.ini" />
    <None Include="Makefile" />
    <None Include="README.md" />
    <None Include="setup\setup_px4_sitl.sh" />
    <None Include="tests\test.py" />
    <None Include=".gitignore" />
    <None Include=".gitmodules" />
  </ItemGroup>
  <!-- Import CPP Targets -->
  <Import Project="$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>